(()=>{let e=()=>{bl(!1);let e=kt("map");ml(e),$(e),Yl()};window.addEventListener("load",async()=>{await _e([["packed","packed.png",16,16,2,2,["map","t","a","misc"]]]),d(),e()});let t=e=>{let t=[];for(let l in e)t.push(`${l}:${e[l]}`);return t.join(";")},l=function(e,l){var r;let n=[],i=null==l?void 0:l.style;i&&(l.style=t(i));let o=Array.prototype.slice.call(arguments,2);for(let e=0;e<o.length;e++){let t=o[e];if("string"==typeof t)n.push(Y(t));else if(void 0!==(null===(r=t)||void 0===r?void 0:r.length))for(let e=0;e<t.length;e++)t[e]&&n.push(t[e]);else n.push(t)}return K(e,l||{},n)},r=(e,t,l)=>{if(0===l)return[[e,t]];{let l=[];for(let r=-1;r<=1;r++)for(let n=-1;n<=1;n++)l.push([e+n,t+r]);return l}},n=(e,t)=>Math.floor(Math.random()*(t-e)+e),i=e=>e[n(0,e.length)],o=(e,t,l,r,i)=>{if(t===e)return 0;let[o,a]=l,s=n(o,a);ge(Z(t),-s);let[f,u]=ne(t),d=Rt(15,f,u,""+s),c=nl(i);return Xt(c,d),de(e,!0),r&&Ll(r),s},a=[(e,t)=>{},(e,t)=>{let l=(e,t)=>{let[l,r]=ne(e),[n,i]=ne(t);return[n-l,i-r]};if(((e,t)=>{let[r,n]=l(e,t);return Math.abs(r)<6&&Math.abs(n)<6})(e,Dt(t.player))){let r=((e,t)=>{let[r,n]=l(e,t);return 0===n?r>0?[M]:[k]:0===r?n>0?[w]:[v]:r>0&&n>0?[S,w,M]:r>0&&n<0?[E,v,M]:r<0&&n>0?[_,w,k]:[x,v,k]})(e,Dt(t.player));for(let l in r)if(N(e,r[l],t))break}}],s=!1,f=!1,u=e=>{let t=hl();s?f||(f=!0,setTimeout(()=>{s=!1,f&&(f=!1,u(e))},16)):(s=!0,Il(),Ol(e,t))},d=()=>{let e={40:w,34:S,35:_,37:k,12:b,39:M,36:x,38:v,33:E,32:b,98:w,99:S,97:_,100:k,101:b,102:M,103:x,104:v,105:E,81:x,87:v,69:E,65:k,83:b,68:M,90:_,88:w,67:S};window.addEventListener("keydown",t=>{let l=pl();if(kl())return;Cl("");let{which:r}=t,n=e[r]||r,i=Dt(l.player),o=nl(l);switch(!0){case(s=+n)>=1&&s<=9:a=n,c(),A(l.player,a,l);break;case 27===n:c(),Yl(),u(l);break;case 192===n:let e=Wt(o,i),[r,f,d]=e[0]||[];r&&y(r,i,f,d,o);break;default:if(!t.shiftKey&&n>48&&n<=57){let e=n-49,t=ee(i)[e];if(t){let l=xt(t);At(t)?(Sl(e),p(l,i)):$t(t)&&g(e,i)}}if(t.shiftKey&&n>48&&n<=57||192===t.which){let e=Wt(o,i),t=n-49,[l,r,a]=e[t]||[];l&&y(l,i,r,a,o)}}var a,s});let t=Ae();t.onmousemove=e=>{let t=pl(),l=hl();if(_l()){let{offsetX:n,offsetY:i}=e,o=Nl(),a=Dt(t.player),[s,f]=ne(a),d=vl()*l,c=s*d+d/2,h=f*d+d/2,m=Math.floor(n/d),p=Math.floor(i/d);Xl(c,h,n,i),Jt(r(m,p,o),nl(t)),u(t)}else jl()},t.onmousedown=e=>{let t=xl();if(t){let l=pl(),{offsetX:r,offsetY:n}=e,i=2*vl();t(Math.floor(r/i),Math.floor(n/i)),u(l)}}},c=()=>{jl(),Al(),Zt(nl(pl()));let e=xl();e&&e(-1,-1)},h=(e,t,l,r,n)=>{let o;if(1===e)o=n?Xe:Oe;else if(2===e)o=n?Ge:je;else{if(3!==e)return;o=n?Ke:Ye}let a=i(o);Yt(r,a,t,l)},m=(e,t)=>{let[l,r]=ne(e);h(t.lvl,l,r,t)},p=async(e,t)=>{Ll("use"),Yl(),await Nt(e)(t)&&(re(t,e),Sl(-1)),Yl()},g=async(e,t)=>{Ll("eqp"),ae(t,e),Yl()},y=(e,t,l,r,n)=>{let i=xt(e),o=bt(i);Vt(n,o,l,r),Tt(e)&&(le(t,e),Ll("acquire")),Yl(),$(pl())},v="8",w="2",k="4",b="5",M="6",x="7",E="9",_="1",S="3",A=(e,t,l)=>{let r=Dt(e);N(r,t,l),(e=>{let t=Dt(e),[l,r]=ne(t),[n,i]=e,o=n,a=i,s=gl();return l<0&&(n--,l=s-1),r<0&&(i--,r=s-1),l>=s&&(n++,l=0),r>=s&&(i++,r=0),It(e,n,i),ie(t,l,r),o!==n||a!==i})(e)?$(l):T()},N=(e,t,l)=>{let r=nl(l),[i,o,a,s,f]=((e,t,l)=>{let[r,n]=ne(e),i=r,o=n;switch(t){case v:n--;break;case w:n++;break;case k:r--;break;case M:r++;break;case x:r--,n--;break;case E:r++,n--;break;case _:r--,n++;break;case S:r++,n++}let a=r,s=n,f=[i,o,a,s,!1],u=nl(l);if(u){let e=jt(u,r,n);if(e&&!tl(e))return f;if(Ot(u,r,n))return f}return[r,n,a,s,!0]})(e,t,l);((e,t,l)=>{let[r,n]=ne(e),i=r-t;se(e,i>0?Q:0===i?n-l>0?J:Q:J)})(e,a,s),ie(e,i,o);let u=Ot(r,a,s),d=pe(e);return u&&d!==pe(u)?(((e,t,l)=>{if(t===e)return 0;let[r,i]=ve(e),o=n(r,i+1);ge(Z(t),-o);let[a,s]=ne(t),f=Rt(0,a,s,""+o),u=nl(l);Xt(u,f),de(e,!0),Ll("strike")})(e,u,l),!0):f},T=()=>{bl(!0);let e=pl(),t=nl(e);for(let e=0;e<t.a.length;e++)fe(t.a[e],!0);C()},$=e=>{let t=nl(e),l=Dt(e.player),[r,n]=ne(l);L(r,n,t),Il(),Ol(e,2)},C=()=>{let t=pl(),l=nl(t);if(l.p.length){for(let e=0;e<l.p.length;e++){let t=l.p[e],[,r,n]=t;+new Date-r>=n&&(l.p.splice(e,1),e--)}return setTimeout(C,16),void $(t)}let r=Dt(t.player);if(ce(r),he(r))return Ll("lose"),void setTimeout(()=>{e()},2e3);for(let e=0;e<l.a.length;e++){let r=l.a[e];if(he(r))l.a.splice(e,1),e--,m(r,l),Ll("dead"),r[13]&&r[13]();else{if(ue(r)){fe(r,!1);let e=me(r);return(0,a[e])(r,t),void setTimeout(C,1)}ce(r)}}$(t),Yl(),setTimeout(()=>{bl(!1)},16)},D=()=>{$l(!0),Dl(!0),Ll("win"),setTimeout(()=>{Il()})};window.finalRoom=()=>{Ll("sell");let e=pl(),t=e.player,l=Dt(t);Lt(e.player,-404);let[r,n]=e.end;It(t,r,n),ie(l,6,11);let i=nl(e),o=["Lord","a",14,11,6,Ve(150),[qe],0,1,!0,!1,2,0,D];i.a.push(o),Cl("Who dares challenge me!"),$(e),Yl()};let z=e=>{let t=[];for(var l=0;l<e[0];++l)t.push(1===e.length?0:z(e.slice(1)));return t},L=(e,t,l)=>{let r=gl(),n=z([r,r]),i=(e,t,r,i)=>{let o=1,a=Math.abs(r-e),s=e<r?1:-1,f=Math.abs(i-t),u=t<i?1:-1,d=(a>f?a:-f)/2,c=0;for(;c++,!(c>10);){let c=e,h=t;if(void 0===n[h]||void 0===n[h][c])continue;if(0!==n[h][c]&&1!==o||(n[h][c]=o),ll(jt(l,c,h))&&(o=0),e===r&&t===i)break;let m=d;m>-a&&(d-=f,e+=s),m<f&&(d+=a,t+=u)}};for(let l=-7;l<=7;l++)i(e,t,e+l,t+7),i(e,t,e+l,t-7),i(e,t,e+7,t+l),i(e,t,e-7,t+l);n[t][e]=1,((e,t)=>{for(let l=0;l<t.length;l++)for(let r=0;r<t[0].length;r++)e[l][r]=e[l][r]||t[l][r]})(l.explMap,n),l.visMap=n};var I={},U=[],q=e=>null==e?e:e.key,F=function(e){this.tag[e.type](e)},P=(e,t,l,r,n)=>{"key"===t||("o"===t[0]&&"n"===t[1]?((e.tag||(e.tag={}))[t=t.slice(2)]=r)?l||e.addEventListener(t,F):e.removeEventListener(t,F):!n&&"list"!==t&&"form"!==t&&t in e?e[t]=null==r?"":r:null==r||!1===r?e.removeAttribute(t):e.setAttribute(t,r))},B=(e,t)=>{var l=e.props,r=3===e.tag?document.createTextNode(e.type):(t=t||"svg"===e.type)?document.createElementNS("http://www.w3.org/2000/svg",e.type,{is:l.is}):document.createElement(e.type,{is:l.is});for(var n in l)P(r,n,null,l[n],t);return e.children.map(e=>r.appendChild(B(e=O(e),t))),e.dom=r},R=(e,t,l,r,n)=>{if(l===r);else if(null!=l&&3===l.tag&&3===r.tag)l.type!==r.type&&(t.nodeValue=r.type);else if(null==l||l.type!==r.type)t=e.insertBefore(B(r=O(r),n),t),null!=l&&e.removeChild(l.dom);else{var i,o,a,s,f=l.props,u=r.props,d=l.children,c=r.children,h=0,m=0,p=d.length-1,g=c.length-1;for(var y in n=n||"svg"===r.type,Object.assign(Object.assign({},f),u))("value"===y||"selected"===y||"checked"===y?t[y]:f[y])!==u[y]&&P(t,y,f[y],u[y],n);for(;m<=g&&h<=p&&null!=(a=q(d[h]))&&a===q(c[m]);)R(t,d[h].dom,d[h++],c[m]=O(c[m++]),n);for(;m<=g&&h<=p&&null!=(a=q(d[p]))&&a===q(c[g]);)R(t,d[p].dom,d[p--],c[g]=O(c[g--]),n);if(h>p)for(;m<=g;)t.insertBefore(B(c[m]=O(c[m++]),n),(o=d[h])&&o.dom);else if(m>g)for(;h<=p;)t.removeChild(d[h++].dom);else{var v={},w={};for(y=h;y<=p;y++)null!=(a=d[y].key)&&(v[a]=d[y]);for(;m<=g;)a=q(o=d[h]),s=q(c[m]=O(c[m])),w[a]||null!=s&&s===q(d[h+1])?(null==a&&t.removeChild(o.dom),h++):null==s||1===l.tag?(null==a&&(R(t,o&&o.dom,o,c[m],n),m++),h++):(a===s?(R(t,o.dom,o,c[m],n),w[s]=!0,h++):null!=(i=v[s])?(R(t,t.insertBefore(i.dom,o&&o.dom),i,c[m],n),w[s]=!0):R(t,o&&o.dom,null,c[m],n),m++);for(;h<=p;)null==q(o=d[h++])&&t.removeChild(o.dom);for(var y in v)null==w[y]&&t.removeChild(v[y].dom)}}return r.dom=t},O=e=>!0!==e&&!1!==e&&e?e:G(""),X=e=>3===e.nodeType?G(e.nodeValue,e):j(e.nodeName.toLowerCase(),I,U.map.call(e.childNodes,X),e,null,1),j=(e,t,l,r,n,i)=>({type:e,props:t,children:l,dom:r,key:n,tag:i}),G=(e,t)=>j(e,I,U,t,null,3);let Y=G,K=(e,t,l)=>j(e,t,Array.isArray(l)?l:null==l?U:[l],null,t.key);var V,W=.3;W=.3,V=(e=1,t=.05,l=220,r=0,n=0,i=.1,o=0,a=1,s=0,f=0,u=0,d=0,c=0,h=0,m=0,p=0,g=0,y=1,v=0,w=44100,k=99+r*w,b=n*w,M=i*w,x=v*w,E=g*w,_=2*Math.PI,S=(e=>0<e?1:-1),A=k+x+b+M+E,N=(s*=500*_/w**2),T=(l*=(1+2*t*Math.random()-t)*_/w),$=S(m)*_/4,C=0,D=0,z=0,L=0,I=0,U=0,q=1,F=[],P=zzfxX.createBufferSource(),B=zzfxX.createBuffer(1,A,w))=>{for(P.connect(zzfxX.destination);z<A;F[z++]=U)++I>100*p&&(I=0,U=C*l*Math.sin(D*m*_/w-$),U=S(U=o?1<o?2<o?3<o?Math.sin((U%_)**3):Math.max(Math.min(Math.tan(U),1),-1):1-(2*U/_%2+2)%2:1-4*Math.abs(Math.round(U/_)-U/_):Math.sin(U))*Math.abs(U)**a*e*W*(z<k?z/k:z<k+x?1-(z-k)/x*(1-y):z<k+x+b?y:z<A-E?(A-z-E)/M*y:0),U=E?U/2+(E>z?0:(z<A-E?1:(z-A)/E)*F[z-E|0]/2):U),C+=1-h+1e9*(Math.sin(z)+1)%2*h,D+=1-h+1e9*(Math.sin(z)**2+1)%2*h,l+=s+=500*f*_/w**3,q&&++q>d*w&&(l+=u*_/w,T+=u*_/w,q=0),c&&++L>c*w&&(l=T,s=N,L=1,q=q||1);return B.getChannelData(0).set(F),P.buffer=B,P.start(),P},zzfxX=new AudioContext;let H,Q=0,J=1,Z=e=>e[5],ee=e=>e[6],te=(e,t,l)=>{let r=ee(e),n=xt(t),i=bt(n);for(let n=0;n<r.length;n++){let o=r[n],a=xt(o);if(i===bt(a)){if(l){let e=Et(t),l=_t(o,e);r[n]=l}else{let t=_t(o,-1);if(t)r[n]=t;else{let t=oe(e),l=e[12];if(t){let r=xt(t);bt(r)===i?ae(e,-1):l>n&&ae(e,l-1)}r.splice(n,1)}}return}}l&&r.push(t)},le=(e,t)=>{te(e,t,!0)},re=(e,t)=>{te(e,t,!1)},ne=e=>e.slice(3,5),ie=(e,t,l)=>{e[3]=t,e[4]=l},oe=e=>ee(e)[e[12]]||null,ae=(e,t)=>{e[12]=t},se=(e,t)=>{e[7]=t},fe=(e,t)=>{e[9]=t},ue=e=>e[9],de=(e,t)=>{e[10]=t},ce=e=>{de(e,!1)},he=e=>ye(Z(e))<=0,me=e=>e[8],pe=e=>0===me(e)?0:1,ge=(e,t)=>{e[0]+=t,e[0]<0?e[0]=0:e[0]>e[1]&&(e[0]=e[1])},ye=e=>e[0],ve=e=>{let t=oe(e),[l,r]=[1,3];if(t){let[n,i]=Ct(xt(t),e);l+=n,r+=i}return[l,r]},we=null,ke=null,be=null,Me=e=>{let[t,l,r,n]=Se(e.width,e.height),i=r/2,o=n/2;return l.translate(i,o),l.rotate(Math.PI/2),l.drawImage(e,-i,-o),t},xe=e=>{let[t,l,r]=Se(e.width,e.height);return l.translate(r,0),l.scale(-1,1),l.drawImage(e,0,0),t},Ee=e=>{let[,,,t,l]=e,[r,n]=Se(t,l);return ql(e,0,0,1,n),r},_e=async e=>{let t={},l={};await Promise.all(e.map(([e,r,n,i,o,a,s])=>new Promise(f=>{let u=new Image;u.onload=()=>{t[e]=u,((e,t,l,r,n,i,o)=>{let a=(t,l,r,n,i,o)=>e[t]=[l,r,n,i,o],s=(e,t,l)=>{let i=e;for(let e=0;e<l;e++)i=Me(i);a(`${t}_r${l}`,i,0,0,r,n)},f=t.width/r/i,u=t.height/n/o;for(let e=0;e<o;e++)for(let o=0;o<i;o++){let d=l[e*i+o],c=0;for(let l=0;l<u;l++)for(let i=0;i<f;i++){let h=`${d}_${c}`,m=a(`${d}_${c}`,t,o*r*f+i*r,e*n*u+l*n,r,n);s(Ee(m),h,1),s(Ee(m),h,2),s(Ee(m),h,3);let p=xe(Ee(m));a(h+"_f",p,0,0,r,n),c++}}})(l,u,s,n,i,o,a),f()},u.src=r}))),ke=t,be=l},Se=(e,t)=>{let l=document.createElement("canvas");l.width=e,l.height=t;let r=l.getContext("2d");return r.imageSmoothingEnabled=!1,[l,r,e,t]},Ae=()=>{if(we)return we;{let[e,t]=Se(576,576);return e.id="canv",t.lineWidth=2,window.canvasDiv.appendChild(e),we=e,e}},Ne=()=>Ae().getContext("2d"),Te=async(e,t,l,n,i,a)=>{if(a=a||await(async e=>new Promise(t=>{El(!0),Tl(e),Ml((e,l)=>{e>-1&&l>-1?(jl(),Al(),t([e,l])):t(null),Ml(null),c()})}))(l)){let s=pl(),[f,u]=a,d=r(f,u,l),c=!1;for(let l=0;l<d.length;l++){let[r,a]=d[l],f=Ot(nl(s),r,a);f&&0===e&&(o(t,f,n,c?"":i,s),c=!0)}return c?(T(),!0):(Ll("cancel"),!1)}return!1},$e=(e,t)=>()=>(Ll("gold"),Lt(pl().player,n(e,t)),!1),Ce=[13,"Gold S",{onAcq:$e(1,5)},0],De=[13,"Gold M",{onAcq:$e(5,10)},1],ze=[13,"Gold L",{onAcq:$e(10,15)},1],Le=[14,"Key",{async onUse(e){let t=pl(),l=nl(t),[n,i]=ne(e),o=r(n,i,1);for(let e=0;e<o.length;e++){let[r,n]=o[e],i=jt(l,r,n);if(i){let e=el(i);if(e===Pt||e===Ft)return Ll("unlock"),Gt(l,r,n,Bt),e===Ft&&h(l.lvl,r,n,l,!0),setTimeout(()=>{$(t)}),!0}}return Cl("You are nearby nothing to unlock!"),Ll("cancel"),!1}},10],Ie=[2,"Knife",{getDmg:()=>[4,8]},1],Ue=[3,"Sword",{getDmg:()=>[8,16]},5],qe=[3,"Fine Sword",{getDmg:()=>[16,24]},15],Fe=[6,"Scroll: Flame",{onUse:e=>Te(0,e,0,[13,20],"flame")},50],Pe=[6,"Scroll: Combust",{onUse:e=>(Ll("flame"),Te(0,e,1,[18,28],"",ne(e)))},25],Be=[6,"Scroll: Fireball",{onUse:e=>Te(0,e,1,[15,25],"flame")},75],Re=[9,"Potion",{onUse:async e=>(ge(Z(e),n(5,15)),!0)},50],Oe=[Ie,Ue,Ce,Fe,Pe,Re,Le],Xe=[[Re,3],[Fe,3],[Pe,2],[Be,2]],je=[Ue,Ce,De,Fe,Pe,qe,Re],Ge=[[Be,2],[Fe,5],[Re,5]],Ye=[De,ze,qe,Fe,Re,[Re,2],Le],Ke=[[4,"Magic Sword",{getDmg:()=>[30,55]},404],[[6,"Scroll: Eviscerate",{onUse:async e=>Te(0,e,0,[32,40],"flame")},200],3]],Ve=e=>[e,e],We=[2,1,"mG",Ve(6),1],He=[4,1,"g",Ve(14),1],Qe=[6,1,"C",Ve(17),1],Je=[10,1,"G",Ve(32),1],Ze=[[We,4,6,12,Ie],[He,4,6,10,Ie]],et=[[We,0,2,12,Ue],[He,2,6,10,Ie],[Qe,1,4,4,qe],[Je,1,2,10,Ue]],tt=[[He,0,2,12,Ue],[Qe,2,5,10,qe],[Je,8,10,10,Ue]],lt=[1,3,4],rt=[2,5,6,7],nt=[8],it=[9,10,11],ot=[14],at=[12,13],st=(e,t)=>[e%t,Math.floor(e/t)],ft=(e,t,l)=>t*l+e,ut=()=>i(["","_r1","_r2","_r3","_f"]),dt=(e,t)=>{let l=gl(),r=e*l;return t.tiles.slice(r,r+l)},ct=(e,t)=>{let l=[],r=gl();for(let n=0;n<gl();n++)l.push(t.tiles[e+n*r]);return l},ht=(e,t)=>t.rooms.filter(t=>t.lvl===e),mt=(e,t,l)=>{let r=[],n=[e],i=[],o=t=>{t&&(t.lvl!==l||r.includes(t)?t.lvl!==e.lvl||i.includes(t)||n.push(t):r.push(t))};do{let e=n.shift();i.push(e),pt(e,t).forEach(o)}while(n.length);return r},pt=(e,t)=>{let l=yl(),[r,n]=st(t.rooms.indexOf(e),l);return[wl(r,n-1,t),wl(r,n+1,t),wl(r-1,n,t),wl(r+1,n,t)]},gt=(e,t,l)=>{let r=gl();pt(e,l).forEach((l,n)=>{let i=t=>{((e,t)=>{t[0]="t_"+e,t[1]=e})(e.tiles[r+1][1],t)};if(l===t)switch(n){case 0:dt(0,e).slice(4,-4).forEach(i);break;case 1:dt(r-1,e).slice(4,-4).forEach(i);break;case 2:ct(0,e).slice(4,-4).forEach(i);break;case 3:ct(r-1,e).slice(4,-4).forEach(i)}})},yt=(e,t,l)=>{let r=()=>i(1===e?lt:2===e?nt:ot);e>1&&(t.lvl=e,t.mod=ut(),t.id=r());for(let n=0;n<4;n++){let n=mt(t,l,0);if(n.length){let t=i(n);t.lvl=e,t.mod=ut(),t.id=r()}}},vt=(e,t)=>{let l=(e,t,l,r)=>[n(e,e+l),n(t,t+r)],r=(e,t,l)=>{let r=jt(l,e,t),n=Ot(l,e,t);return!(!tl(r)||null!==n)},i=gl();t.forEach(t=>{let o,a,[s,f,u,d,c]=t,h=i/2-d/2,m=0,p=n(f,u+1);for(let t=0;t<p;t++){let t=!1;do{let[e,r]=l(h,h,d,d);if(o=e,a=r,m++,m>10){t=!0;break}}while(!r(o,a,e));if(t)continue;let[n,i,f,u,p]=s,g=[f,"a",n,o,a,[...u],[c],0,p,!0,!1,i,0,0];e.a.push(g)}})},wt={5011569:0,634050:1,255255255:2,25523198:3,256163:4,357193:5,"000":6,79103129:7,606060:8,803030:9,18411180:10,4132209:11,2295968:12,44232244:13,25114643:14,175191210:15},kt=e=>{let t=[0,0,["player","a",0,9,12,Ve(100),[Ie,[Re,3]],0,0,!0,!1,0,0,0],0],l={rooms:[],p:[],player:t,end:[]},r=yl(),n=gl(),o=r*r;for(let e=0;e<o;e++){let e={lvl:0,id:15,tiles:[],p:[],visMap:z([n,n]),explMap:z([n,n]),items:[],a:[],mod:""};l.rooms.push(e)}let a=i(l.rooms);a.lvl=1,a.id=0;let s,f=l.rooms.indexOf(a),[u,d]=st(f,r);It(t,u,d);do{s=i(l.rooms)}while(s===a);s.lvl=4,s.id=15,s.mod="";let c=l.rooms.indexOf(s);l.end=st(c,4),yt(1,a,l);let m=i(mt(a,l,0));yt(2,m,l);let p=mt(m,l,0),g=i(p.length?p:mt(a,l,0));if(yt(3,g,l),ht(3,l).length<=2||ht(2,l).length<=2)return kt(e);ht(0,l).forEach(e=>{e.lvl=1,e.mod=ut(),e.id=i(lt)}),i(ht(1,l).filter(e=>e!==a)).id=i(rt),i(ht(2,l)).id=i(it),i(ht(3,l)).id=i(at);let y=(e,t)=>["t_14",14,e,t,!1];for(let t=0;t<o;t++){let{tiles:r,id:i,mod:o}=l.rooms[t],[,a]=Se(16,16);ql(e+"_"+i+o,0,0,1,a);let{data:s}=a.getImageData(0,0,16,16);for(let e=0;e<n*n;e++){let[t,l]=st(e,n);r.push(y(t,l))}let f=0;for(let e=0;e<s.length;e+=4){let t=wt[`${s[e+0]}${s[e+1]}${s[e+2]}`]||0,l=1+f%16,i=1+Math.floor(f/16);r[ft(l,i,n)]=["t_"+t,t,l,i,!1],f++}}for(let e=0;e<o;e++){let t=l.rooms[e];pt(t,l).forEach(e=>{e&&e.lvl===t.lvl&&gt(t,e,l)})}let v=i(mt(a,l,2));pt(v,l).forEach(e=>{e&&1===e.lvl&&(gt(v,e,l),gt(e,v,l))});let w=mt(v,l,3),k=i(w.length?w:mt(a,l,3));pt(k,l).forEach(e=>{e&&2===e.lvl&&(gt(k,e,l),gt(e,k,l))}),pt(s,l).forEach(e=>{e&&(gt(s,e,l),gt(e,s,l))}),ht(1,l).forEach(e=>{e!==a&&vt(e,Ze)}),ht(2,l).forEach(e=>{vt(e,et)}),ht(3,l).forEach(e=>{e!==s&&vt(e,tt)});let b=[name,"a",12,4,12,Ve(100),[],0,0,!0,!1,2,0,0];return a.a.push(b),h(1,4,6,a),h(1,13,3,a),l},bt=e=>e[1],Mt=e=>"misc_"+e[0],xt=e=>2===e.length?e[0]:e,Et=e=>2===e.length?e[1]:1,_t=(e,t)=>{if(2===e.length){let l=e[1]+t;return l<0&&(l=0),e[1]=l,l?e:null}return t>0?[e,1+t]:null},St=e=>xt(e)[3],At=e=>!!Nt(e),Nt=e=>xt(e)[2].onUse,Tt=e=>{let t=xt(e)[2].onAcq;return!t||t()},$t=e=>!!xt(e)[2].getDmg,Ct=(e,t)=>{let l=e[2];return l.getDmg?l.getDmg(t):[0,0]},Dt=e=>e[2],zt=e=>[e[0],e[1]],Lt=(e,t)=>{e[3]+=t},It=(e,t,l)=>{e[0]=t,e[1]=l},Ut=[3,4,5,6,9,10,11,12,13,14],qt=[3,4,5,6,14],Ft=10,Pt=9,Bt=0,Rt=(e,t,l,r)=>["misc_"+e,+new Date,500,t,l,r],Ot=(e,t,l)=>{for(let r=0;r<e.a.length;r++){let n=e.a[r],[i,o]=ne(n);if(i===t&&o===l)return n}let r=pl();if(r){let e=Dt(r.player),[n,i]=ne(e);if(n===t&&i===l)return e}return null},Xt=(e,t)=>{e.p.push(t)},jt=(e,t,l)=>{let r=gl();return t<0||t>=r||l<0||l>=r?null:e.tiles[l*gl()+t]},Gt=(e,t,l,r)=>{let n=jt(e,t,l);n&&(n[0]="t_"+r,n[1]=r)},Yt=(e,t,l,r)=>{e.items.push([t,l,r])},Kt=(e,t,l)=>{let r=[];for(let n=0;n<e.items.length;n++){let[,i,o]=e.items[n];t===i&&l===o&&r.push(e.items[n])}return r},Vt=(e,t,l,r)=>{let{items:n}=e;for(let e=0;e<n.length;e++){let[i,o,a]=n[e];if(l===o&&r===a&&t===bt(xt(i)))return n.splice(e,1),!0}return!1},Wt=(e,t)=>{let l=[],[r,n]=ne(t);for(let t=-1;t<=1;t++)for(let i=-1;i<=1;i++)l=l.concat(Kt(e,r+i,n+t));return l},Ht=(e,t,l)=>!!e.visMap[l][t],Qt=(e,t,l)=>!!e.explMap[l][t],Jt=(e,t)=>{Zt(t);for(let l=0;l<e.length;l++){let[r,n]=e[l];rl(jt(t,r,n),!0)}},Zt=e=>{for(let t=0;t<e.tiles.length;t++)rl(e.tiles[t],!1)},el=e=>(null==e?void 0:e[1])||0,tl=e=>!Ut.includes(el(e)),ll=e=>qt.includes(el(e)),rl=(e,t)=>{e&&(e[4]=t)},nl=e=>{let t=e.player,[l,r]=zt(t),n=yl();return e.rooms[r*n+l]},il=null,ol=!1,al=!1,sl=-1,fl=null,ul=null,dl="",cl=!1,hl=()=>2,ml=e=>il=e,pl=()=>il,gl=()=>18,yl=()=>4,vl=()=>16,wl=(e,t,l)=>{let r=yl();return e<0||t<0||e>=r||t>=r?null:l.rooms[t*r+e]||null},kl=()=>ol,bl=e=>ol=e,Ml=e=>fl=e,xl=()=>fl,El=e=>al=e,_l=()=>al,Sl=e=>sl=e,Al=()=>Sl(-1),Nl=()=>ul,Tl=e=>{ul=e},$l=e=>H=e,Cl=e=>dl=e,Dl=e=>cl=e,zl={start:[,,17,.05,.21,.09,,2.92,,23,,,,,,.1,.37,,1],strike:[,0,822,.1,.08,.13,4,2.12,-12,-9.3,,,,,.2],dead:[2,,449,.01,,.08,3,2.15,-10,,,,,,,.2,.12,.36,.01],lose:[.3,,306,.08,.2,.83,2,.92,,-1.7,-5,.06,.18,,,.1,,.87,.09],eqp:[.5,,1966,,.13,0,4,1.15,-18,,,,,.1,-.6,,,.1,.06],use:[,,19,.01,,.05,4,.55,-.2,.8,,.04,,.4,-5,,,,.02],flame:[,,569,.01,,.42,3,.3,,.6,,,,1.1,3,,.16,.92],sell:[,0,853,.04,,,1,2.63,,.3,,,,,-.4,,.14,.13,.01],gold:[,0,457,,.23,,1,1.58,,,,,.07,,,,,.69],acquire:[.3,,14,.03,,.07,3,.3,,48,,,,,,,,,.04],cancel:[,0,177,.02,,.07,,.21,,-.4,764,.11,,,,,.06,.28,.03],talk:[,.3,527,.02,.03,0,2,.18,,-70,13,,,.1,,.6,.11],unlock:[,,823,.01,.03,0,3,.01,22,,,,.04,,6.3,,.18,,.06],win:[,,1257,.17,.17,.16,,.56,,,669,,.53,.8,-4.6,,.23,.8,.15]},Ll=e=>{W=.3,V(...zl[e])},Il=()=>{let e=Ae();Fl(0,0,e.width,e.height,"#333")},Ul=(e,t)=>{(t=t||Ne()).globalAlpha=e},ql=(e,t,l,r,n)=>{r=r||1,n=n||Ne();let[i,o,a,s,f]="string"==typeof e?be[e]:e;n.drawImage(i,o,a,s,f,t,l,s*r,f*r)},Fl=(e,t,l,r,n,i,o)=>{(o=o||Ne())[i?"strokeStyle":"fillStyle"]=n,o[i?"strokeRect":"fillRect"](e,t,l,r)},Pl=(e,t,l,r)=>{let[n,i]=ne(e),o=(e=>e[1]+"_"+(e[2]+(e[10]?1:0))+(e[7]===Q?"_f":""))(e),a=vl()*t;ql(o,l+n*a,r+i*a,t)},Bl=(e,t,l,r)=>{t=t||1;let[n,,,i,o,a]=e,s=vl(),f=s*t/2,u=s*t,d=l+i*u,c=r+o*u;if(n&&ql(n,d,c,t),a){let e=Ne();e.font="16px monospace",e.fillStyle="#FFF",e.fillText(a,d+f-(2===a.length?9:5),c+f+5)}},Rl=(e,t,l,r,n,i)=>{let o=Mt(e),a=vl()*r;ql(o,n+t*a+8,i+l*a+8,r-1)},Ol=(e,t)=>{let l=yl(),r=vl(),n=e.player,[i,o]=zt(n),a=r*t,s=e.rooms[o*l+i];for(let e in s.tiles){let[l,,r,n]=s.tiles[e],i=r*a,o=n*a;Qt(s,r,n)?ql(l,i,o,t):Fl(i,o,a,a,"#333",!0)}for(let e in s.items){let[l,r,n]=s.items[e],i=xt(l);Ht(s,r,n)&&Rl(i,r,n,t,0,0)}for(let e in s.tiles){let[,,l,r,n]=s.tiles[e],i=Ot(s,l,r),o=l*a,f=r*a;Ht(s,l,r)?i&&Pl(i,t,0,0):Qt(s,l,r)&&(Ul(.15),Fl(o,f,a,a,"black",!1),Ul(1)),n&&Fl(o,f,a,a,"#ddd",!0)}let f=Dt(n);Pl(f,t,0,0);for(let e=0;e<s.p.length;e++)Bl(s.p[e],t,0,0)},Xl=(e,t,l,r)=>{let n=Jl("tgt");er(n,{display:"block"});let i=n.children[0];i.setAttribute("x1",""+e),i.setAttribute("x2",""+l),i.setAttribute("y1",""+t),i.setAttribute("y2",""+r)},jl=()=>{El(!1),er(Jl("tgt"),{display:"none"})},Gl=(e,t,l,r)=>{let n=Zl(Kl);if(Ql(n,"item hrz"),e){let r=xt(e),i=Et(e),o=bt(r),a=Mt(r),s=oe(l)===e;er(n,{"justify-content":"flex-start"}),t===sl&&er(n,{background:"#444"});let f=Zl(Kl);Ql(f,"vrt menu-item-ctr");let u=e=>()=>{let r=l[12],n=((e,t,l)=>{let r=e+l;if(r<0||r>=t.length)return e;let n=t[e];return t[e]=t[e+l],t[e+l]=n,e+l})(t,ee(l),e),i=r;n===r&&(i=r-e),s&&(i=t+e),ae(l,i),Yl()},d="cyc-item",c=Zl(Kl,"up");Ql(c,d),c[Wl]=u(-1),Hl(f,c);let h=Zl(Kl,"dn");Ql(h,d),h[Wl]=u(1),Hl(f,h),Hl(n,f);let m=Zl(Kl,t+1+". ");er(m,{margin:"5px",width:"20px"}),Hl(n,m);let y=Zl(Kl);Ql(y,"vrt menu-item-ctr"),Hl(n,y);let v=pl();if(((e,t)=>{let l=nl(t),r=Dt(e),[n,i]=ne(r);return 0===l.id&&((e,t,l,r,n,i)=>e>=3&&e<=5&&t>=11&&t<=13)(n,i)})(v.player,v)){let t=Zl(Kl,"SELL");t[Wl]=()=>{((e,t)=>{Ll("sell");let l=St(e);Lt(t,l);let r=Dt(t);re(r,e),Yl()})(e,pl().player)},Ql(t,"menu-item"),er(t,{background:"#994"}),Hl(y,t);let l=Zl(Kl,St(e)+" gold ");er(l,{"text-align":"center",color:"#FFE762",margin:"5px",width:"32px"}),Hl(n,l)}else{if(At(e)){let e=Zl(Kl,"USE");Ql(e,"menu-item"),e[Wl]=async()=>{Sl(t),p(r,l)},Hl(y,e)}if($t(e)&&!s){let e=Zl(Kl,"EQP");e[Wl]=()=>{g(t,l)},Ql(e,"menu-item"),Hl(y,e)}}let[w,k]=Se(32,32);er(w,{margin:"2px"}),ql(a,0,0,2,k),Hl(n,w);let b=Zl(Kl,`${o} ${i>1?"("+i+")":""}`,{width:"90px"});s&&er(b,{color:"#9ef"}),Hl(n,b)}Hl(r,n)},Yl=()=>{let e=pl(),t=Jl("invDiv");t[Vl]="";let l=Jl("rightPane");cl||H?er(l,{width:"0"}):(er(l,{width:""}),((e,t)=>{let l=Zl(Kl);l.onscroll=()=>{tr=l.scrollTop},Ql(l,"inventory");let r=Zl(Kl,"INVENTORY");Ql(r,"title"),Hl(l,r);let n=Dt(e),i=ee(n);for(let e=0;e<10;e++)Gl(i[e],e,n,l);Hl(t,l),l.scrollTop=tr})(e.player,t),((e,t)=>{(e=R(e.parentNode,e,e.v||X(e),t)).v=t})(l,rr(e))),er(document.body.children[0],{display:"flex"})},Kl="div",Vl="innerHTML",Wl="onclick",Hl=(e,t)=>{e.appendChild(t)},Ql=(e,t)=>{e.className=t},Jl=e=>document.getElementById(e),Zl=(e,t,l)=>{let r=document.createElement(e);return t&&(r[Vl]=t),l&&er(r,l),r},er=(e,t)=>{for(let l in t)e.style[l]=t[l]},tr=0,lr={},rr=t=>l("div",null,l("div",{className:"ctrl info-item hrz"},l("div",{id:"reset-item",className:"menu-item",style:{width:"80px"},onclick:()=>e()},"Reset")),l("div",{className:"ctrl info-item",style:{height:"134px"}}),l("div",{className:"pickup info-item",scrollTop:0},((e,t)=>{let r=Dt(e),n=Wt(t,r);return l("div",null,l("div",{className:"title"},"NEARBY ITEMS"),n.map(([e,n,i],o)=>((e,t,r,n,i,o)=>{if(!e)return l("div",{key:t,className:"item hrz",style:{width:"155px",background:"#555"}});let a=xt(e),s=Et(e),f=bt(a),u=Mt(a),d=lr[u];if(!d){let[e,t]=Se(32,32);ql(u,0,0,2,t),d=e.toDataURL(),lr[u]=d}return l("div",{key:f+t,className:"item hrz",style:{width:"155px",background:"#555","justify-content":"flex-start"},onclick:()=>y(e,o,n,i,r)},l("span",null,"!@#$%^&*()_+"[t]+"."),l("img",{src:d}),l("span",null,`${f} ${s>1?"("+s+")":""}`))})(e,o,t,n,i,r)))})(t.player,nl(t))))})();