(()=>{async function e(){}function t(e){let{spriteIndex:t,spriteSheet:l,name:r,stats:a,behavior:s,talkTrigger:n,stepTrigger:i,dropLevel:o,facing:u,talkPortrait:c}=Object.assign(Object.assign({},ce),e);return[t,l,r,a,s,n,i,o,u,c]}let l=e=>{let t=[];for(let l in e)t.push(`${l}:${e[l]}`);return t.join(";")},r=(e,t)=>{se(e,t)},a=function(e,t){var r;let a=[],s=null==t?void 0:t.style;s&&(t.style=l(s));let n=Array.prototype.slice.call(arguments,2);for(let e=0;e<n.length;e++){let t=n[e];if("string"==typeof t)a.push(re(t));else if(void 0!==(null===(r=t)||void 0===r?void 0:r.length))for(let e=0;e<t.length;e++)t[e]&&a.push(t[e]);else{if(!t.type)throw Error("Invalid child provided to superfine: "+JSON.stringify(t));a.push(t)}}return ae(e,t||{},a)};e();let s=function(e){let t={},l={};return t["Alinea_CH_SpyRigby.json"]=e=>(Y.set("curIN2f","Alinea_CH_SpyRigby.json"),l.Hg9db=()=>{Y.set("lasIN2f",Y.get("curIN2f"));let e=t.NONE;e?e():V.exit()},void 0===e?l.Hg9db():e&&l[e](),Y.state),t["Alinea_CH_RadmilaOmvaire.json"]=e=>(Y.set("curIN2f","Alinea_CH_RadmilaOmvaire.json"),l.KxZH3=()=>{Y.set("lasIN2f",Y.get("curIN2f"));let e=t.NONE;e?e():V.exit()},void 0===e?l.KxZH3():e&&l[e](),Y.state),t["Alinea_CH_Sol.json"]=e=>(Y.set("curIN2f","Alinea_CH_Sol.json"),l.tG08a=()=>{Y.set("lasIN2f",Y.get("curIN2f"));let e=t.NONE;e?e():V.exit()},void 0===e?l.tG08a():e&&l[e](),Y.state),t["Alinea_CH_SirLavolanChevel.json"]=e=>(Y.set("curIN2f","Alinea_CH_SirLavolanChevel.json"),l.r7TWk=()=>{Y.set("lasIN2f",Y.get("curIN2f"));let e=t.NONE;e?e():V.exit()},void 0===e?l.r7TWk():e&&l[e](),Y.state),t["Alinea_CH_Idoreo.json"]=e=>(Y.set("curIN2f","Alinea_CH_Idoreo.json"),l.FdbAF=()=>{Y.set("lasIN2f",Y.get("curIN2f"));let e=t.NONE;e?e():V.exit()},void 0===e?l.FdbAF():e&&l[e](),Y.state),t["Alinea_CH_DunnsMurose.json"]=e=>(Y.set("curIN2f","Alinea_CH_DunnsMurose.json"),l.YDiFN=()=>{Y.set("lasIN2f",Y.get("curIN2f"));let e=t.NONE;e?e():V.exit()},void 0===e?l.YDiFN():e&&l[e](),Y.state),t["Alinea_CH_BartoloCaldeburn.json"]=e=>(Y.set("curIN2f","Alinea_CH_BartoloCaldeburn.json"),l.enWMm=()=>{Y.set("curIN2n","enWMm"),Y.once()?l.mqogS():l.SwzEw()},l.mqogS=()=>{Y.set("curIN2n","mqogS"),V.say("A nobleman sits here, his clothes gaudy and pretentious, a deep blue lace lining every possible edge of his silk coat.  He clasps a large glass of plum wine and idly taps a finger on the rough wood of the table.  He ignores the other patrons in the room as his gaze passes imperiously by them to rest upon you.",l.dY7sz)},l.dY7sz=()=>{Y.set("curIN2n","dY7sz"),V.say('"And what have we here?  Another rabble come to further dissuade me from this pit of a town?"',l.ku2iV)},l.ku2iV=()=>{Y.set("curIN2n","ku2iV"),V.choose("","ku2iV",[{t:"Who are you?",cb:l.ASqD8,c:()=>!0},{t:"Don't like Alinea much?",cb:l.zkasm,c:()=>!0},{t:"You work for Lord Guildimarche?  Who is that?",cb:l.GM0EE,c:()=>Y.get("nodes.ASqD8")},{t:"What is someone as 'esteemed' as you doing here?",cb:l.KLPVt,c:()=>Y.get("nodes.ASqD8")},{t:"Idle threats?  Are you always this distasteful?",cb:l.DRtxf,c:()=>Y.get("nodes.OfySb")},{t:"There are bandits to the north?",cb:l.wEid3,c:()=>Y.get("nodes.KLPVt")},{t:"Nevermind.",cb:l.udfI0,c:()=>!0}])},l.ASqD8=()=>{Y.set("curIN2n","ASqD8"),V.say('"Lord Bartolo Caldeburn, originally of the Esthsmund Estates.  You\'ve heard of those?"',l.zfyBY)},l.zfyBY=()=>{Y.set("curIN2n","zfyBY"),V.say("(You haven't.)",l.tE4LF)},l.tE4LF=()=>{Y.set("curIN2n","tE4LF"),V.say('He grows irritated.  "Yes well... They are renowned on the Mainland for their luxury.  I suppose simpletons such as yourselves would not understand.  Suffice to say that I am important.  Very important.  You should certainly not underestimate that fact.  These days I give my assistance to Lord Guildimarche and his grand estate."',l.ku2iV)},l.zkasm=()=>{Y.set("curIN2n","zkasm"),V.say('"Certainly not!  The people here no nothing of luxury.  They they think only in singles." He taps his glass. "A mere single selection of wine, a single bed, a single tavern...  How can a man visit this town with anything but disappointment?"',l.gIcZc)},l.gIcZc=()=>{Y.set("curIN2n","gIcZc"),V.say('"Only thing it has plenty of is Larks."  He makes a shooing gesture at you.',l.ku2iV)},l.GM0EE=()=>{Y.set("curIN2n","GM0EE"),V.say("He is aghast.  \"I do not 'work for' Lord Guildimarche, as you so uncouthly put it.  We are of the noble persuasion, we do favors for each other.  We lend aid!\"  ",l.ViWA8)},l.ViWA8=()=>{Y.set("curIN2n","ViWA8"),V.say('"It just so happens that the Guildimarche estate has quite the pull on Sadelica.  Save for Alinea and perhaps the Magi Tower, go most anywhere on this island and you\'ll find some establishment associated with that name.  This is not a coincidence.  Perhaps *you* would not know of such things, but support for such a strong house tends to bear fruit."',l.ku2iV)},l.KLPVt=()=>{Y.set("curIN2n","KLPVt"),V.say('"I am waiting for the Bandits currently occupying the northern bridge to be dealt with.  Then I can safety return to a place of relative sanity."',l.OfySb)},l.OfySb=()=>{Y.set("curIN2n","OfySb"),V.say('"Watch your tone, or you might find your tongue in a ditch somewhere."  He takes a small sip from his drink, and you notice a wickedly curved blade on a hilt at his hip.',l.ku2iV)},l.DRtxf=()=>{Y.set("curIN2n","DRtxf"),V.say('"Like most reasonable people, I do not suffer fools."',l.ku2iV)},l.wEid3=()=>{Y.set("curIN2n","wEid3"),V.say('"Yes there are, and they have been quite the nuisance.  I\'m simply waiting for them to be dealt with.  It is only a matter of time."',l.ku2iV)},l.udfI0=()=>{Y.set("lasIN2f",Y.get("curIN2f"));let e=t.NONE;e?e():V.exit()},l.SwzEw=()=>{Y.set("curIN2n","SwzEw"),V.say('"Back again I see..."',l.ku2iV)},void 0===e?l.enWMm():e&&l[e](),Y.state),t["Alinea_CH_Chem.json"]=e=>(Y.set("curIN2f","Alinea_CH_Chem.json"),l.RLgZd=()=>{Y.set("lasIN2f",Y.get("curIN2f"));let e=t.NONE;e?e():V.exit()},void 0===e?l.RLgZd():e&&l[e](),Y.state),t["Alinea_CH_GuardCaptainMullen.json"]=e=>(Y.set("curIN2f","Alinea_CH_GuardCaptainMullen.json"),l.F3tbm=()=>{Y.set("lasIN2f",Y.get("curIN2f"));let e=t.NONE;e?e():V.exit()},void 0===e?l.F3tbm():e&&l[e](),Y.state),t["Alinea_CH_DockmasterClaire.json"]=e=>(Y.set("curIN2f","Alinea_CH_DockmasterClaire.json"),l.G2sLG=()=>{Y.set("curIN2n","G2sLG"),Y.once()?l.XgRzi():l.BgtJr()},l.XgRzi=()=>{Y.set("curIN2n","XgRzi"),V.say("A stern woman, clipboard in hand, oversees the workers bustling about the docks.  She barks orders with every other breath, gesturing curtly with bony fingers and an icy glare.  A bright green tabard marks her as a Realm adjutant.  Your approach hardly gives her pause.",l.BgtJr)},l.BgtJr=()=>{Y.set("curIN2n","BgtJr"),V.say('"What is it?  What do you need?"',l.qlRtQ)},l.qlRtQ=()=>{Y.set("curIN2n","qlRtQ"),V.choose("","qlRtQ",[{t:"Who are you?",cb:l.DERfp,c:()=>!0},{t:'What are "Larks"?',cb:l.Y5uuR,c:()=>Y.get("nodes.DERfp")},{t:"Nevermind.",cb:l.w1b5S,c:()=>!0}])},l.DERfp=()=>{Y.set("curIN2n","DERfp"),V.say('She spits at the ground.  "Faw!  Larks!  As clueless as ever I see."',l.Ip8B3)},l.Ip8B3=()=>{Y.set("curIN2n","Ip8B3"),V.say("She points at her tabard as if that was self-explanitory.  \"I'm Claire.  Dock Master here in Alinea.  That means try to behave when I'm around or I'll have to send you into seclusion.  Had a few troublemakers just yesterday, thought they could sneak a few shipments of shelk into warehouse 3.\"  She shakes her head in disappointment.  \"I'd feel bad for them if I hadn't seen the like a hundred times over.\"",l.qlRtQ)},l.Y5uuR=()=>{Y.set("curIN2n","Y5uuR"),V.say("\"It means you're new here.  Get used to that label.  You're the Larkiest Larks I've ever seen.\"",l.qlRtQ)},l.w1b5S=()=>{Y.set("lasIN2f",Y.get("curIN2f"));let e=t.NONE;e?e():V.exit()},void 0===e?l.G2sLG():e&&l[e](),Y.state),t["Alinea_CH_SchovanAbivola.json"]=e=>(Y.set("curIN2f","Alinea_CH_SchovanAbivola.json"),l.OhVgn=()=>{Y.set("lasIN2f",Y.get("curIN2f"));let e=t.NONE;e?e():V.exit()},void 0===e?l.OhVgn():e&&l[e](),Y.state),t["Alinea_CH_Gruff.json"]=e=>(Y.set("curIN2f","Alinea_CH_Gruff.json"),l.f1zni=()=>{Y.set("lasIN2f",Y.get("curIN2f"));let e=t.NONE;e?e():V.exit()},void 0===e?l.f1zni():e&&l[e](),Y.state),t["Alinea_CH_Igmund.json"]=e=>(Y.set("curIN2f","Alinea_CH_Igmund.json"),l.iPi3f=()=>{Y.set("lasIN2f",Y.get("curIN2f"));let e=t.NONE;e?e():V.exit()},void 0===e?l.iPi3f():e&&l[e](),Y.state),t["Alinea_CH_AldebethBlackrose.json"]=e=>(Y.set("curIN2f","Alinea_CH_AldebethBlackrose.json"),l.QUeaf=()=>{Y.set("lasIN2f",Y.get("curIN2f"));let e=t.NONE;e?e():V.exit()},void 0===e?l.QUeaf():e&&l[e](),Y.state),t["Alinea_CH_Elvyosa.json"]=e=>(Y.set("curIN2f","Alinea_CH_Elvyosa.json"),l.m8Gsl=()=>{Y.set("lasIN2f",Y.get("curIN2f"));let e=t.NONE;e?e():V.exit()},void 0===e?l.m8Gsl():e&&l[e](),Y.state),t["Alinea_CH_Scopey.json"]=e=>(Y.set("curIN2f","Alinea_CH_Scopey.json"),l.bUbbt=()=>{Y.set("lasIN2f",Y.get("curIN2f"));let e=t.NONE;e?e():V.exit()},void 0===e?l.bUbbt():e&&l[e](),Y.state),t.exit=()=>{V.exit()},{files:t,scope:l}}(),n=()=>{gl(!1);let e=Fe("map1");cl(e),T(e),Zl()};window.addEventListener("load",async()=>{await Promise.all([Be([["packed","packed.png",16,16,2,2,["terrain2","terrain3","actors2","misc1"]],["terrain1","terrain1.png",16,16,1,1,["terrain1"]],["actors1","actors1.png",16,16,1,1,["actors1"]],["map1","map1.png",64,64,1,1,["map1"]],["portrait1","portrait1.png",32,32,1,1,["portrait1"]]]),Rl()]),P(),g(),n()});let i=(e,t,l)=>{if(0===l)return[[e,t]];{let l=[];for(let r=-1;r<=1;r++)for(let a=-1;a<=1;a++)l.push([e+a,t+r]);return l}},o=(e,t)=>Math.floor(Math.random()*(t-e)+e),u=e=>e[o(0,e.length)],c=(e,t,l,r,a)=>{if(t===e)return 0;let[s,n]=l,i=o(s,n);Me(me(t),-i);let[u,c]=Ne(t),d=St(15,u,c,""+i),h=El(a);return Mt(h,d),Ce(e,!0),r&&Pl(r),i},d=[(e,t)=>{},(e,t)=>{let l=(e,t)=>{let[l,r]=Ne(e),[a,s]=Ne(t);return[a-l,s-r]};if(((e,t)=>{let[r,a]=l(e,t);return Math.abs(r)<6&&Math.abs(a)<6})(e,It(t.player))){let r=((e,t)=>{let[r,a]=l(e,t);return 0===a?r>0?[C]:[_]:0===r?a>0?[k]:[I]:r>0&&a>0?[D,k,C]:r>0&&a<0?[E,I,C]:r<0&&a>0?[S,k,_]:[x,I,_]})(e,It(t.player));for(let l in r)if(j(e,r[l],t))break}}],h=!1,f=!1,m=e=>{let t=ul();h?f||(f=!0,setTimeout(()=>{h=!1,f&&(f=!1,m(e))},16)):(h=!0,Gl(),Ul(e,t))},g=()=>{let e={40:k,34:D,35:S,37:_,12:A,39:C,36:x,38:I,33:E,98:k,99:D,97:S,100:_,101:A,102:C,103:x,104:I,105:E,81:x,87:I,69:E,65:_,83:A,68:C,90:S,88:k,67:D};window.addEventListener("keydown",t=>{let l=dl();if(ml())return;let{which:r}=t,a=e[r]||r,n=It(l.player),i=El(l);switch(!0){case(u=+a)>=1&&u<=9:t.preventDefault(),o=a,p(),M(l.player,o,l);break;case 27===a:p(),Zl(),m(l);break;case 192===a:let e=zt(i,n),[r,c,d]=e[0]||[];r&&w(r,n,c,d,i);break;case 32===a:{let e=Rt(i,n)[0]||[];if(e){let t=Te(e);t&&((e,t)=>{let l=_l();l.splice(0,l.length),xl(t||null),Pl("talk"),Cl(!0),gl(!0),ol(!0),il(!0),Zl(),(e=>{let t=s.files[e+".json"];t?t():console.error(`Cannot play in2 dialog, no key exists: '${e}'`)})(e)})(t,e)}}default:if(!t.shiftKey&&a>48&&a<=57){let e=a-49,t=ge(n)[e];if(t){let l=mt(t);yt(t)?(bl(e),N(l,n)):bt(t)&&b(e,n)}}if(t.shiftKey&&a>48&&a<=57||192===t.which){let e=zt(i,n),t=a-49,[l,r,s]=e[t]||[];l&&w(l,n,r,s,i)}}var o,u});let t=Ve();t.onmousemove=e=>{let t=dl(),l=ul();if(Nl()){let{offsetX:r,offsetY:a}=e,s=Il(),n=It(t.player),[o,u]=Ne(n),c=fl()*l,d=o*c+c/2,h=u*c+c/2,f=Math.floor(r/c),g=Math.floor(a/c);Ql(d,h,r,a),Gt(i(f,g,s),El(t)),m(t)}else Xl()},t.onmousedown=e=>{let t=yl();if(t){let l=dl(),{offsetX:r,offsetY:a}=e,s=2*fl();t(Math.floor(r/s),Math.floor(a/s)),m(l)}}},p=()=>{Xl(),wl(),Vt(El(dl()));let e=yl();e&&e(-1,-1)},y=(e,t,l,r,a)=>{let s;if(1===e)s=a?nt:st;else if(2===e)s=a?ot:it;else{if(3!==e)return;s=a?ct:ut}let n=u(s);Tt(r,n,t,l)},v=(e,t)=>{let[l,r]=Ne(e);y(t.lvl,l,r,t)},N=async(e,t)=>{Pl("use"),Zl(),await vt(e)(t)&&(ve(t,e),bl(-1)),Zl()},b=async(e,t)=>{Pl("eqp"),Ie(t,e),Zl()},w=(e,t,l,r,a)=>{let s=mt(e),n=ht(s);Ot(a,n,l,r),Nt(e)&&(ye(t,e),Pl("acquire")),Zl(),T(dl())},I="8",k="2",_="4",A="5",C="6",x="7",E="9",S="1",D="3",M=(e,t,l)=>{let r=It(e);j(r,t,l),(e=>{let t=It(e),[l,r]=Ne(t),{wx:a,wy:s}=e,n=a,i=s,o=hl();return l<0&&(a--,l=o-1),r<0&&(s--,r=o-1),l>=o&&(a++,l=0),r>=o&&(s++,r=0),At(e,a,s),be(t,l,r),n!==a||i!==s})(e)?T(l):H()},j=(e,t,l)=>{let r=El(l),[a,s,n,i,u]=((e,t,l)=>{let[r,a]=Ne(e),s=r,n=a;switch(t){case I:a--;break;case k:a++;break;case _:r--;break;case C:r++;break;case x:r--,a--;break;case E:r++,a--;break;case S:r--,a++;break;case D:r++,a++}let i=r,o=a,u=[s,n,i,o,!1],c=El(l);if(c){let e=jt(c,r,a);if(e&&$t(e))return Kt(e),Pl("doorOpen"),u;if(e&&!Ft(e))return u;if(Dt(c,r,a))return u}return[r,a,i,o,!0]})(e,t,l);((e,t,l)=>{let[r,a]=Ne(e),s=r-t;ke(e,s>0?ie:0===s?a-l>0?oe:ie:oe)})(e,n,i),be(e,a,s);let c=Dt(r,n,i),d=De(e);return c&&d!==De(c)?(((e,t,l)=>{if(t===e)return 0;let[r,a]=He(e),s=o(r,a+1);Me(me(t),-s);let[n,i]=Ne(t),u=St(0,n,i,""+s),c=El(l);Mt(c,u),Ce(e,!0),Pl("strike")})(e,c,l),!0):u},H=()=>{gl(!0);let e=dl(),t=El(e);for(let e=0;e<t.actors.length;e++)_e(t.actors[e],!0);L()},T=e=>{let t=El(e),l=It(e.player),[r,a]=Ne(l);z(r,a,t),Gl(),Ul(e,2)},L=()=>{let e=dl(),t=El(e);if(t.p.length){for(let e=0;e<t.p.length;e++){let l=t.p[e],[,r,a]=l;+new Date-r>=a&&(t.p.splice(e,1),e--)}return setTimeout(L,32),void T(e)}let l=It(e.player);if(xe(l),Ee(l))return Pl("lose"),void setTimeout(()=>{n()},2e3);for(let l=0;l<t.actors.length;l++){let r=t.actors[l];if(Ee(r))t.actors.splice(l,1),l--,v(r,t),Pl("dead"),r[13]&&r[13]();else{if(Ae(r)){_e(r,!1);let t=Se(r);return(0,d[t])(r,e),void setTimeout(L,1)}xe(r)}}T(e),Zl(),setTimeout(()=>{gl(!1)},32)},O=e=>{let t=[];for(var l=0;l<e[0];++l)t.push(1===e.length?0:O(e.slice(1)));return t},z=(e,t,l)=>{let r=hl(),a=O([r,r]),s=(e,t,r,s)=>{let n=1,i=Math.abs(r-e),o=e<r?1:-1,u=Math.abs(s-t),c=t<s?1:-1,d=(i>u?i:-u)/2,h=0;for(;h++,!(h>10);){let h=e,f=t;if(void 0===a[f]||void 0===a[f][h]){let l=d;l>-i&&(d-=u,e+=o),l<u&&(d+=i,t+=c);continue}if(0!==a[f][h]&&1!==n||(a[f][h]=n),Wt(jt(l,h,f))&&(n=0),e===r&&t===s)break;let m=d;m>-i&&(d-=u,e+=o),m<u&&(d+=i,t+=c)}},n=l=>{for(let r=-l;r<=l;r++)s(e,t,e+r,t+l),s(e,t,e+r,t-l),s(e,t,e+l,t+r),s(e,t,e-l,t+r)};n(8),n(7),n(6),n(5),a[t][e]=1,((e,t)=>{for(let l=0;l<t.length;l++)for(let r=0;r<t[0].length;r++)e[l][r]=e[l][r]||t[l][r]})(l.explMap,a),l.visMap=a},R={},P=()=>{R["1,3,24,28"]=Ll,R["1,3,11,23"]=Ol},B="Press any key or click here to continue.",G=!!window.IN2;var V=window.core={async init(){await e()},async say(e,t){if("object"==typeof e){if(1!==e.length)return void V.say(e[0],()=>{V.say(e.slice(1),t)});q(e)}else{if(e.length<=1)return void(t&&t());q(e),q(B,"#9D9D9D",t)}if(!G)return new Promise(e=>{F.setK(()=>{t&&t(),e()})})},async choose(e,t,l){return new Promise(t=>{q(e||"Select an option.","#9D9D9D"),q("-----","#9D9D9D");let r=l.filter(e=>!!e.c()).map((e,l)=>({text:l+1+".) "+e.t,cb:async()=>{this.onChoose(),await e.cb(),t()}}));r.forEach(({text:e,cb:t})=>{q(e,"#F7E26B",t)}),q("-----","#9D9D9D"),F.setK(async e=>{let l=r[e-1];l&&(F.setK(()=>{}),q(l.text,"#EB8931"),await l.cb(),t())})})},onChoose(){_l().forEach(e=>{e.cb=void 0})},async defer(e,t){t=t||[this.get("curIN2n"),this.get("curIN2f")],await e.apply(null,t)},exit(){F.setK(()=>{}),Pl("talkEnd"),Cl(!1),ol(!1),il(!1),Zl(),setTimeout(()=>{gl(!1)},100)}},Y=window.player={state:{},init(){this.state={}},get(e){let t=(e,l)=>{let r=e.shift();if(!e.length)return void 0===l[r]?void 0:l[r];let a=l[r];return void 0!==a?t(e,a):void 0};return t(e.split("."),this.state)},set(e,t){"curIN2n"===e&&this.set("nodes."+t),"curIN2f"===e&&this.set("files."+t.replace(".json","")),t=void 0===t||t;let l=(e,r)=>{let a=e.shift();void 0!==a&&(e.length?(r[a]||(r[a]={}),l(e,r[a])):r[a]=t)};l(e.split("."),this.state)},once(){let e="once."+this.get("curIN2n");return!this.get(e)&&(this.set(e),!0)},setIfUnset(e,t){void 0===this.get(e)&&this.set(e,t)}},q=(e,t,l)=>{let r=_l(),a=r[r.length-1];a&&a.text===B&&r.splice(r.length-1,1),_l().push({text:e,color:t,cb:l}),Zl(),document.getElementById("dialog").scrollTop=999999},F=new function(){let e=()=>{};this.setK=t=>e=t,window.addEventListener("keydown",t=>{this.disabled||e(String.fromCharCode(t.which))})},W={},$=[],K=e=>null==e?e:e.key,U=function(e){this.tag[e.type](e)},Q=(e,t,l,r,a)=>{"key"===t||("o"===t[0]&&"n"===t[1]?((e.tag||(e.tag={}))[t=t.slice(2)]=r)?l||e.addEventListener(t,U):e.removeEventListener(t,U):!a&&"list"!==t&&"form"!==t&&t in e?e[t]=null==r?"":r:null==r||!1===r?e.removeAttribute(t):e.setAttribute(t,r))},X=(e,t)=>{var l=e.props,r=3===e.tag?document.createTextNode(e.type):(t=t||"svg"===e.type)?document.createElementNS("http://www.w3.org/2000/svg",e.type,{is:l.is}):document.createElement(e.type,{is:l.is});for(var a in l)Q(r,a,null,l[a],t);return e.children.map(e=>r.appendChild(X(e=J(e),t))),e.dom=r},Z=(e,t,l,r,a)=>{if(l===r);else if(null!=l&&3===l.tag&&3===r.tag)l.type!==r.type&&(t.nodeValue=r.type);else if(null==l||l.type!==r.type)t=e.insertBefore(X(r=J(r),a),t),null!=l&&e.removeChild(l.dom);else{var s,n,i,o,u=l.props,c=r.props,d=l.children,h=r.children,f=0,m=0,g=d.length-1,p=h.length-1;for(var y in a=a||"svg"===r.type,Object.assign(Object.assign({},u),c))("value"===y||"selected"===y||"checked"===y?t[y]:u[y])!==c[y]&&Q(t,y,u[y],c[y],a);for(;m<=p&&f<=g&&null!=(i=K(d[f]))&&i===K(h[m]);)Z(t,d[f].dom,d[f++],h[m]=J(h[m++]),a);for(;m<=p&&f<=g&&null!=(i=K(d[g]))&&i===K(h[p]);)Z(t,d[g].dom,d[g--],h[p]=J(h[p--]),a);if(f>g)for(;m<=p;)t.insertBefore(X(h[m]=J(h[m++]),a),(n=d[f])&&n.dom);else if(m>p)for(;f<=g;)t.removeChild(d[f++].dom);else{var v={},N={};for(y=f;y<=g;y++)null!=(i=d[y].key)&&(v[i]=d[y]);for(;m<=p;)i=K(n=d[f]),o=K(h[m]=J(h[m])),N[i]||null!=o&&o===K(d[f+1])?(null==i&&t.removeChild(n.dom),f++):null==o||1===l.tag?(null==i&&(Z(t,n&&n.dom,n,h[m],a),m++),f++):(i===o?(Z(t,n.dom,n,h[m],a),N[o]=!0,f++):null!=(s=v[o])?(Z(t,t.insertBefore(s.dom,n&&n.dom),s,h[m],a),N[o]=!0):Z(t,n&&n.dom,null,h[m],a),m++);for(;f<=g;)null==K(n=d[f++])&&t.removeChild(n.dom);for(var y in v)null==N[y]&&t.removeChild(v[y].dom)}}return r.dom=t},J=e=>!0!==e&&!1!==e&&e?e:le(""),ee=e=>3===e.nodeType?le(e.nodeValue,e):te(e.nodeName.toLowerCase(),W,$.map.call(e.childNodes,ee),e,null,1),te=(e,t,l,r,a,s)=>({type:e,props:t,children:l,dom:r,key:a,tag:s}),le=(e,t)=>te(e,W,$,t,null,3);let re=le,ae=(e,t,l)=>te(e,t,Array.isArray(l)?l:null==l?$:[l],null,t.key);var se=(e,t)=>((e=Z(e.parentNode,e,e.v||ee(e),t)).v=t,e),ne=.3;zzfxX=new(window.AudioContext||webkitAudioContext);let ie=0,oe=1,ue=e=>[e,e],ce={spriteIndex:0,spriteSheet:"actors1",name:"Actor",stats:ue(100),behavior:0,talkTrigger:"",talkPortrait:"",stepTrigger:"",dropLevel:0,facing:oe},de=(e,t,l)=>{let[r,a,s,n,i,o,u,c,d,h]=l;return[s,a,r,e,t,n,[],d,i,!1,!1,c,0,()=>{},o,u,h]},he=e=>e[0],fe=e=>e[1]+"_"+(e[2]+(e[10]?1:0))+(e[7]===ie?"_f":""),me=e=>e[5],ge=e=>e[6],pe=(e,t,l)=>{let r=ge(e),a=mt(t),s=ht(a);for(let a=0;a<r.length;a++){let n=r[a],i=mt(n);if(s===ht(i)){if(l){let e=gt(t),l=pt(n,e);r[a]=l}else{let t=pt(n,-1);if(t)r[a]=t;else{let t=we(e),l=e[12];if(t){let r=mt(t);ht(r)===s?Ie(e,-1):l>a&&Ie(e,l-1)}r.splice(a,1)}}return}}l&&r.push(t)},ye=(e,t)=>{pe(e,t,!0)},ve=(e,t)=>{pe(e,t,!1)},Ne=e=>e.slice(3,5),be=(e,t,l)=>{e[3]=t,e[4]=l},we=e=>ge(e)[e[12]]||null,Ie=(e,t)=>{e[12]=t},ke=(e,t)=>{e[7]=t},_e=(e,t)=>{e[9]=t},Ae=e=>e[9],Ce=(e,t)=>{e[10]=t},xe=e=>{Ce(e,!1)},Ee=e=>je(me(e))<=0,Se=e=>e[8],De=e=>0===Se(e)?0:1,Me=(e,t)=>{e[0]+=t,e[0]<0?e[0]=0:e[0]>e[1]&&(e[0]=e[1])},je=e=>e[0],He=e=>{let t=we(e),[l,r]=[1,3];if(t){let[a,s]=wt(mt(t),e);l+=a,r+=s}return[l,r]},Te=e=>e[14]||"",Le=null,Oe=null,ze=null,Re=e=>{let[t,l,r]=Ge(e.width,e.height);return l.translate(r,0),l.scale(-1,1),l.drawImage(e,0,0),t},Pe=e=>{let[,,,t,l]=e,[r,a]=Ge(t,l);return Yl(e,0,0,1,a),r},Be=async e=>{let t={},l={};await Promise.all(e.map(([e,r,a,s,n,i,o])=>new Promise(u=>{let c=new Image;c.onload=()=>{t[e]=c,((e,t,l,r,a,s,n)=>{let i=(t,l,r,a,s,n)=>e[t]=[l,r,a,s,n],o=t.width/r/s,u=t.height/a/n;for(let e=0;e<n;e++)for(let n=0;n<s;n++){let c=l[e*s+n],d=0;for(let l=0;l<u;l++)for(let s=0;s<o;s++){let h=`${c}_${d}`,f=i(`${c}_${d}`,t,n*r*o+s*r,e*a*u+l*a,r,a);i(h+"_f",Re(Pe(f)),0,0,r,a),d++}}})(l,c,o,a,s,n,i),u()},c.src=r}))),Oe=t,ze=l},Ge=(e,t)=>{let l=document.createElement("canvas");l.width=e,l.height=t;let r=l.getContext("2d");return r.imageSmoothingEnabled=!1,[l,r,e,t]},Ve=()=>{if(Le)return Le;{let[e,t]=Ge(544,544);return e.id="canv",t.lineWidth=2,window.canvasDiv.appendChild(e),Le=e,e}},Ye=()=>Ve().getContext("2d"),qe={};for(let e=0;e<256;e++)qe[`${e}${e}${e}`]=e;let Fe=e=>{let t=["player","actors1",0,0,0,dt(100),[Ze,[at,3]],0,0,!0,!1,0,0,0,"","",""],l={wx:0,wy:0,actor:t,gold:0},[r,a,s,n]=(i=hl(),[Math.floor(87/i),Math.floor(226/i),87%i,226%i-1]);var i;At(l,r,a),be(t,s,n);let o={rooms:[],p:[],player:l,end:[]},c=hl();for(let e=0;e<16;e++){let t={lvl:0,id:e,tiles:[],p:[],visMap:O([c,c]),explMap:O([c,c]),items:[],actors:[],mod:""};o.rooms.push(t)}o.rooms[0].lvl=1;for(let t=0;t<16;t++){let{tiles:l,mod:r,actors:a}=o.rooms[t],[,s]=Ge(64,64),n=t%4,i=Math.floor(t/4);Yl(e+"_"+t+r,0,0,1,s);let{data:d}=s.getImageData(0,0,64,64),h=0;for(let e=0;e<d.length;e+=4){let t=qe[`${d[e+0]}${d[e+1]}${d[e+2]}`]||0,r=h%64,s=Math.floor(h/64),o=s*c+r;t===Tl.Grass?t=u(Ml):t===Tl.CaveFloor&&(t=u(jl)),l[o]=["terrain1_"+t,t,r,s,!1];let f=R[[n,i,r,s].join(",")];if(f){let e=de(r,s,f);a.push(e)}h++}}return o},We=async(e,t,l,r,a,s)=>{if(s=s||await(async e=>new Promise(t=>{vl(!0),kl(e),pl((e,l)=>{e>-1&&l>-1?(Xl(),wl(),t([e,l])):t(null),pl(null),p()})}))(l)){let n=dl(),[o,u]=s,d=i(o,u,l),h=!1;for(let l=0;l<d.length;l++){let[s,i]=d[l],o=Dt(El(n),s,i);o&&0===e&&(c(t,o,r,h?"":a,n),h=!0)}return h?(H(),!0):(Pl("cancel"),!1)}return!1},$e=(e,t)=>()=>(Pl("gold"),_t(dl().player,o(e,t)),!1),Ke=[13,"Gold S",{onAcq:$e(1,5)},0],Ue=[13,"Gold M",{onAcq:$e(5,10)},1],Qe=[13,"Gold L",{onAcq:$e(10,15)},1],Xe=[14,"Key",{async onUse(e){let t=dl(),l=El(t),[r,a]=Ne(e),s=i(r,a,1);for(let e=0;e<s.length;e++){let[r,a]=s[e],n=jt(l,r,a);if(n){let e=Yt(n);if(e===xt||e===Ct)return Pl("unlock"),Ht(l,r,a,Et),e===Ct&&y(l.lvl,r,a,l,!0),setTimeout(()=>{T(t)}),!0}}return Pl("cancel"),!1}},10],Ze=[2,"Knife",{getDmg:()=>[4,8]},1],Je=[3,"Sword",{getDmg:()=>[8,16]},5],et=[3,"Fine Sword",{getDmg:()=>[16,24]},15],tt=[6,"Scroll: Flame",{onUse:e=>We(0,e,0,[13,20],"flame")},50],lt=[6,"Scroll: Combust",{onUse:e=>(Pl("flame"),We(0,e,1,[18,28],"",Ne(e)))},25],rt=[6,"Scroll: Fireball",{onUse:e=>We(0,e,1,[15,25],"flame")},75],at=[9,"Potion",{onUse:async e=>(Me(me(e),o(5,15)),!0)},50],st=[Ze,Je,Ke,tt,lt,at,Xe],nt=[[at,3],[tt,3],[lt,2],[rt,2]],it=[Je,Ke,Ue,tt,lt,et,at],ot=[[rt,2],[tt,5],[at,5]],ut=[Ue,Qe,et,tt,at,[at,2],Xe],ct=[[4,"Magic Sword",{getDmg:()=>[30,55]},404],[[6,"Scroll: Eviscerate",{onUse:async e=>We(0,e,0,[32,40],"flame")},200],3]],dt=ue,ht=(dt(6),dt(14),dt(17),dt(32),e=>e[1]),ft=e=>"misc1_"+e[0],mt=e=>2===e.length?e[0]:e,gt=e=>2===e.length?e[1]:1,pt=(e,t)=>{if(2===e.length){let l=e[1]+t;return l<0&&(l=0),e[1]=l,l?e:null}return t>0?[e,1+t]:null},yt=e=>!!vt(e),vt=e=>mt(e)[2].onUse,Nt=e=>{let t=mt(e)[2].onAcq;return!t||t()},bt=e=>!!mt(e)[2].getDmg,wt=(e,t)=>{let l=e[2];return l.getDmg?l.getDmg(t):[0,0]},It=e=>e.actor,kt=e=>[e.wx,e.wy],_t=(e,t)=>{e.gold+=t},At=(e,t,l)=>{e.wx=t,e.wy=l},Ct=10,xt=9,Et=0,St=(e,t,l,r)=>["misc_"+e,+new Date,500,t,l,r],Dt=(e,t,l)=>{for(let r=0;r<e.actors.length;r++){let a=e.actors[r],[s,n]=Ne(a);if(s===t&&n===l)return a}let r=dl();if(r){let e=It(r.player),[a,s]=Ne(e);if(a===t&&s===l)return e}return null},Mt=(e,t)=>{e.p.push(t)},jt=(e,t,l)=>{let r=hl();return t<0||t>=r||l<0||l>=r?null:e.tiles[l*hl()+t]},Ht=(e,t,l,r)=>{let a=jt(e,t,l);qt(a,r)},Tt=(e,t,l,r)=>{e.items.push([t,l,r])},Lt=(e,t,l)=>{let r=[];for(let a=0;a<e.items.length;a++){let[,s,n]=e.items[a];t===s&&l===n&&r.push(e.items[a])}return r},Ot=(e,t,l,r)=>{let{items:a}=e;for(let e=0;e<a.length;e++){let[s,n,i]=a[e];if(l===n&&r===i&&t===ht(mt(s)))return a.splice(e,1),!0}return!1},zt=(e,t)=>{let l=[],[r,a]=Ne(t);for(let t=-1;t<=1;t++)for(let s=-1;s<=1;s++)l=l.concat(Lt(e,r+s,a+t));return l},Rt=(e,t)=>{let l=[],[r,a]=Ne(t);for(let s=-1;s<=1;s++)for(let n=-1;n<=1;n++){let i=Dt(e,r+n,a+s);i&&i!==t&&(l=l.concat([i]))}return l},Pt=(e,t,l)=>!!e.visMap[l][t],Bt=(e,t,l)=>!!e.explMap[l][t],Gt=(e,t)=>{Vt(t);for(let l=0;l<e.length;l++){let[r,a]=e[l];Ut(jt(t,r,a),!0)}},Vt=e=>{for(let t=0;t<e.tiles.length;t++)Ut(e.tiles[t],!1)},Yt=e=>(null==e?void 0:e[1])||0,qt=(e,t)=>{e&&(e[0]="terrain1_"+t,e[1]=t)},Ft=e=>!Sl.includes(Yt(e)),Wt=e=>Dl.includes(Yt(e)),$t=e=>Hl.includes(Yt(e)),Kt=e=>{let t=Yt(e);qt(e,t+1)},Ut=(e,t)=>{e&&(e[4]=t)},Qt=null,Xt=!1,Zt=!1,Jt=-1,el=null,tl=null,ll=!1,rl=null,al=[],sl=!1,nl=!1,il=e=>sl=e,ol=e=>nl=e,ul=()=>2,cl=e=>Qt=e,dl=()=>Qt,hl=()=>64,fl=()=>16,ml=()=>Xt,gl=e=>Xt=e,pl=e=>el=e,yl=()=>el,vl=e=>Zt=e,Nl=()=>Zt,bl=e=>Jt=e,wl=()=>bl(-1),Il=()=>tl,kl=e=>{tl=e},_l=()=>al,Al=()=>ll,Cl=e=>ll=e,xl=e=>{rl=e},El=e=>{let t=e.player,[l,r]=kt(t);return e.rooms[4*r+l]},Sl=[1,2,3,4,5,7,8,9,12,14,16,24,25,26,30,35,36,39,40,41,42,43,44,45,46,52,53,54,55,56,57,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,87,88,89,90,91,92,93,94,95,96,97,98,99,102,103,104,105,106,107,108,109,110,111,112,113,114],Dl=[1,2,3,4,5,8,9,12,14,24,25,26,39,40,41,52,53,54,55,56,57,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,87,88,89,90,91,92,93,94,95,96,97,98,99],Ml=[0,0,0,0,0,0,17,17,17,18,18,18,19,20,21],jl=[63,64,65,66,67],Hl=[5,59],Tl={Grass:0,Chest:14,Water:15,CaveFloor:63},Ll=t({spriteIndex:10,spriteSheet:"actors1",name:"Dock Master",stats:ue(100),behavior:0,talkTrigger:"Alinea_CH_DockmasterClaire",stepTrigger:"",dropLevel:0,facing:oe,talkPortrait:"portrait1_0"}),Ol=t({spriteIndex:16,spriteSheet:"actors1",name:"Noble",stats:ue(100),behavior:0,talkTrigger:"Alinea_CH_BartoloCaldeburn",stepTrigger:"",dropLevel:0,facing:ie,talkPortrait:""}),zl=(t({spriteIndex:16,spriteSheet:"actors1",name:"Noble",stats:ue(100),behavior:0,talkTrigger:"Alinea_CH_AldebethBlackrose",stepTrigger:"",dropLevel:0,facing:ie,talkPortrait:""}),{talk:[.6,0,326,.08,,.07,1,.25,,33,-111,.01,,,2.9,.8,.06,.22,.05,.01],talkEnd:[.6,0,326,.08,,.07,1,.15,.1,33,-111,.01,,,2.9,.6,.05,.52,.05,.01],doorOpen:"snd/door-open.mp3"}),Rl=async()=>{let e=[];for(let t in zl){let l=zl[t];"string"==typeof l&&e.push(new Promise((e,r)=>{let a=""+l,s=new Audio(a);s.autoplay=!1,s.oncanplay=()=>{s.oncanplay=null,s.currentTime=99999999999;let l=s.currentTime;s.currentTime=0,s.onended=function(){s.pause(),s.currentTime=0},zl[t]={sound:s,audio:s,soundDuration:l},e()},s.addEventListener("error",e=>{console.error(e),r('Cannot load sound: name="'+t+'", url="'+a+'"')}),s.src=a}))}await Promise.all(e)},Pl=e=>{let t=zl[e];if(t)if(t.length)ne=.3,((e=1,t=.05,l=220,r=0,a=0,s=.1,n=0,i=1,o=0,u=0,c=0,d=0,h=0,f=0,m=0,g=0,p=0,y=1,v=0,N=0)=>{let b,w,I=2*Math.PI,k=o*=500*I/44100**2,_=(0<m?1:-1)*I/4,A=l*=(1+2*t*Math.random()-t)*I/44100,C=[],x=0,E=0,S=0,D=1,M=0,j=0,H=0;for(u*=500*I/44100**3,m*=I/44100,c*=I/44100,d*=44100,h=44100*h|0,w=(r=99+44100*r)+(v*=44100)+(a*=44100)+(s*=44100)+(p*=44100)|0;S<w;C[S++]=H)++j%(100*g|0)||(H=n?1<n?2<n?3<n?Math.sin((x%I)**3):Math.max(Math.min(Math.tan(x),1),-1):1-(2*x/I%2+2)%2:1-4*Math.abs(Math.round(x/I)-x/I):Math.sin(x),H=(h?1-N+N*Math.sin(2*Math.PI*S/h):1)*(0<H?1:-1)*Math.abs(H)**i*e*ne*(S<r?S/r:S<r+v?1-(S-r)/v*(1-y):S<r+v+a?y:S<w-p?(w-S-p)/s*y:0),H=p?H/2+(p>S?0:(S<w-p?1:(w-S)/p)*C[S-p|0]/2):H),b=(l+=o+=u)*Math.sin(E*m-_),x+=b-b*f*(1-1e9*(Math.sin(S)+1)%2),E+=b-b*f*(1-1e9*(Math.sin(S)**2+1)%2),D&&++D>d&&(l+=c,A+=c,D=0),!h||++M%h||(l=A,o=k,D=D||1);(e=zzfxX.createBuffer(1,w,44100)).getChannelData(0).set(C),(l=zzfxX.createBufferSource()).buffer=e,l.connect(zzfxX.destination),l.start()})(...t);else{let e=function(e){let t=Object.assign(Object.assign({},e),{audio:e.audio.cloneNode(),soundName:name,duration:0,isPlaying:!1,isPaused:!1});return t.sound=t.audio,t}(t),{sound:l}=e;l.volume=.3,l.play(),t.lastStartTimestamp=performance.now(),t.isPlaying=!0}else console.error("No sound exists with name: "+e)},Bl={font:"monospace",color:"#fff",size:14,align:"center",strokeColor:""},Gl=()=>{let e=Ve();ql(0,0,e.width,e.height,"black")},Vl=(e,t)=>{(t=t||Ye()).globalAlpha=e},Yl=(e,t,l,r,a)=>{r=r||1,a=a||Ye();let s="string"==typeof e?ze[e]:e;if(!s)throw Error(`Cannot find sprite with name: "${e}"`);let[n,i,o,u,c]=s;a.drawImage(n,i,o,u,c,t,l,u*r,c*r)},ql=(e,t,l,r,a,s,n)=>{(n=n||Ye())[s?"strokeStyle":"fillStyle"]=a,n[s?"strokeRect":"fillRect"](e,t,l,r)},Fl=(e,t,l,r,a)=>{let{font:s,size:n,color:i,align:o,strokeColor:u}=Object.assign(Object.assign({},Bl),r||{});(a=a||Ye()).font=`${n}px ${s}`,a.fillStyle=i,a.textAlign=o,a.textBaseline="middle",a.fillText(e,t,l),u&&(a.strokeStyle=u,a.lineWidth=.5,a.strokeText(e,t,l))},Wl=(e,t,l,r,a)=>{let[s,n]=Ne(e),[i,o]=t,u=fe(e),c=fl()*l;Yl(u,r+s*c-i*c,a+n*c-o*c,l)},$l=(e,t,l,r,a)=>{l=l||1;let[s,,,n,i,o]=e,u=fl(),c=u*l/2,d=u*l,[h,f]=t,m=r+n*d-h*d,g=a+i*d-f*d;if(s&&Yl(s,m,g,l),o){let e=Ye();e.font="16px monospace",e.fillStyle="#FFF",e.fillText(o,m+c-(2===o.length?9:5),g+c+5)}},Kl=(e,t,l,r,a,s,n)=>{let i=ft(e),[o,u]=t,c=fl()*a;Yl(i,s+l*c-o*c+8,n+r*c-u*c+8,a-1)},Ul=(e,t)=>{let l=fl(),r=e.player,[a,s]=kt(r),n=l*t,i=e.rooms[4*s+a],o=It(r),u=(e=>{let t=It(e.player),l=hl(),[r,a]=Ne(t),s=[r-8,a-8,17,17];return s[0]<0?s[0]=0:s[0]+s[2]>=l&&(s[0]=l-s[2]),s[1]<0?s[1]=0:s[1]+s[3]>=l&&(s[1]=l-s[3]),s})(e),[c,d,h,f]=u;Wl(o,u,t,0,0);let m=Rt(i,o);for(let e in i.tiles){let[l,,r,a]=i.tiles[e],s=r*n-c*n,o=a*n-d*n;Bt(i,r,a)?(Yl(l,s,o,t),Pt(i,r,a)||(Vl(.15),ql(s,o,n,n,"black",!1),Vl(1))):ql(s,o,n,n,"black",!0)}for(let e in i.items){let[l,r,a]=i.items[e],s=mt(l);Pt(i,r,a)&&Kl(s,u,r,a,t,0,0)}for(let e in i.tiles){let[,,l,r,a]=i.tiles[e],s=Dt(i,l,r),o=l*n,h=r*n;if(Pt(i,l,r)&&s&&(Wl(s,u,t,0,0),m[0]===s&&Te(s))){let e=o-c*n+n/2,t=h-d*n-8;Fl(he(s),e,t)}a&&ql(o,h,n,n,"#ccc",!0)}for(let e=0;e<i.p.length;e++)$l(i.p[e],u,t,0,0);for(let e=0;e<m.length;e++){let t=m[e],[l,r]=Ne(t);if(Te(t)){let e=l-c*n+n/2,a=r-d*n-8;Fl(he(t),e,a)}}},Ql=(e,t,l,r)=>{let a=tr("tgt");lr(a,{display:"block"});let s=a.children[0];s.setAttribute("x1",""+e),s.setAttribute("x2",""+l),s.setAttribute("y1",""+t),s.setAttribute("y2",""+r)},Xl=()=>{vl(!1),lr(tr("tgt"),{display:"none"})},Zl=()=>{let e=dl(),t=tr("rightPane"),l=tr("leftPane"),a=tr("dialog");lr(t,{width:""}),r(l,ir(e)),r(t,or(e)),r(a,ar()),lr(document.body.children[0],{display:"flex"})},Jl={},er={},tr=e=>document.getElementById(e),lr=(e,t)=>{for(let l in t)e.style[l]=t[l]},rr=e=>{let t=Jl[e];if(!t){let[l,r]=Ge(32,32);Yl(e,0,0,2,r),t=l.toDataURL(),Jl[e]=t}return t},ar=()=>{let e=_l(),t=Al(),l=rl,r=(e=>(null==e?void 0:e[16])||"")(l),s=4,n=32;r||(r=l?fe(l):"actors1_0",s=4,n=16);let i=((e,t,l)=>{l=l||1,t=t||16;let r=er[e];if(!r){let[a,s]=Ge(t*l,t*l);Yl(e,0,0,l,s),r=a.toDataURL(),er[e]=r}return r})(r,n,s);return a("div",{style:{height:t?"100%":"0px",opacity:t?"1":"0"}},a("div",{className:"dialog-bg",style:{opacity:t?"1":"0"}}),a("div",{className:"title"},"DIALOG"),a("div",{className:"dialog-portrait hrz"},a("img",{style:{margin:"2px",background:"#CCCCCC",padding:"5px",border:"2px outset white"},src:i})),e.map(({text:e,color:t,cb:l})=>a("div",{className:"dialog-line"+(l?" dialog-line-choice":""),style:{color:t||""},onclick:()=>{l&&l()}},e)))},sr=0,nr=(e,t,l)=>{if(!e)return a("div",{className:"item hrz"});let r=mt(e),s=gt(e),n=ht(r),i=ft(r),o=rr(i),u=we(l)===e,c=e=>()=>{let r=l[12],a=((e,t,l)=>{let r=e+l;if(r<0||r>=t.length)return e;let a=t[e];return t[e]=t[e+l],t[e+l]=a,e+l})(t,ge(l),e),s=r;a===r&&(s=r-e),u&&(s=t+e),Ie(l,s),Zl()},d=[];return yt(e)&&d.push(a("div",{className:"menu-item",onclick:async()=>{bl(t),N(r,l)}},"USE")),bt(e)&&!u&&d.push(a("div",{className:"menu-item",onclick:async()=>{b(t,l)}},"EQP")),a("div",{className:"item hrz",style:{"justify-content":"flex-start",background:t===Jt?"#444":"unset"}},a("div",{className:"vrt menu-item-ctr"},a("div",{className:"cyc-item",onclick:c(-1)},"up"),a("div",{className:"cyc-item",onclick:c(1)},"dn")),a("div",{style:{margin:"5px",width:"20px"}},t+1+". "),a("div",{className:"vrt menu-item-ctr"},d),a("img",{style:{margin:"2px"},src:o}),a("div",{style:{color:u?"#9ef":"unset"}},`${n} ${s>1?"("+s+")":""}`))},ir=e=>{let t=sl;return a("div",{id:"leftPane"},(e=>{let t=It(e),l=ge(t),r=[],s=Al();for(let e=0;e<24;e++)r.push(nr(l[e],e,t));return a("div",{id:"invDiv"},a("div",{className:"inventory",onscroll:e=>{var t;sr=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.scrollTop},scrollTop:sr},a("div",{className:"title"},"INVENTORY"),r),a("div",{className:"overlay",style:{width:s?"100%":"0"}}))})(e.player),a("div",{className:"overlay",style:{left:0,width:t?"100%":"0"}}))},or=e=>{let t=nl;return a("div",null,a("div",{className:"ctrl info-item hrz"},a("div",{id:"reset-item",className:"menu-item",style:{width:"80px"},onclick:()=>n()},"Reset")),a("div",{className:"ctrl info-item",style:{height:"100px"}}),a("div",{className:"pickup info-item",scrollTop:0},((e,t)=>{let l=It(e),r=zt(t,l);return a("div",null,a("div",{className:"title"},"NEARBY ITEMS"),r.map(([e,r,s],n)=>((e,t,l,r,s,n)=>{if(!e)return a("div",{key:t,className:"item hrz",style:{width:"155px",background:"#555"}});let i=mt(e),o=gt(e),u=ht(i),c=ft(i),d=rr(c);return a("div",{key:u+t,className:"item hrz",style:{width:"155px",background:"#555","justify-content":"flex-start"},onclick:()=>w(e,n,r,s,l)},a("span",null,"!@#$%^&*()_+"[t]+"."),a("img",{src:d}),a("span",null,`${u} ${o>1?"("+o+")":""}`))})(e,n,t,r,s,l)))})(e.player,El(e))),a("div",{className:"overlay",style:{right:0,width:t?"100%":"0"}}))}})();